@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

<h2>My Profile</h2>
<p><strong>First Name:</strong> <span id="firstName"></span></p>
<p><strong>Middle Name:</strong> <span id="midName"></span></p>
<p><strong>Last Name:</strong> <span id="lastName"></span></p>
<p><strong>Email:</strong> <span id="email"></span></p>
<p><strong>Phone:</strong> <span id="phone"></span></p>


<script>
    $(document).ready(function () {
        const token = localStorage.getItem("token");

        if (!token) {
            // Redirect to login if token is missing
            window.location.href = "/Auth/Login";
            return;
        }

        try {
            // Decode the token to get user details
            const tokenParts = token.split('.');
            const payload = JSON.parse(atob(tokenParts[1]));
            const email = payload.email;

            // Fetch the profile data
            $.ajax({
                url: `https://localhost:7056/api/User/getProfile?email=${encodeURIComponent(email)}`,
                type: "GET",
                headers:
                {
                    "Authorization": `Bearer ${token}`
                },
                success: function (data) {
                    // Populate profile information in the page
                    $("#firstName").text(data.firstName);
                    $("#midName").text(data.midName);
                    $("#lastName").text(data.lastName);
                    $("#email").text(data.email);
                    $("#phone").text(data.phone);
                    // Add additional fields as necessary
                },
                error: function () {
                    showErrorPopup("Không thể tải thông tin hồ sơ!");
                }
            });
        }
        catch (error) {
            console.error("Error decoding token:", error);
            window.location.href = "/Auth/Login";
        }
    });
</script>



